import{P as t,j as e,p as P,d as b,s as L}from"./index-6ffcc819.js";import{a as J,c as k,d as A,u as T,s as q,b as $,f as K}from"./fbStore-ed2d4d67.js";import{r as h}from"./react-3321cb07.js";import{Q as w}from"./react-toastify.esm-32f2537d.js";import{r as B,u as E,a as I}from"./fbStorage-a10cdba0.js";import{B as M}from"./BannerSection-3199f79d.js";import{s}from"./styles.module-9ce859ce.js";import{d as W,u as O,e as V}from"./reactRouter-dd40e030.js";import"./recoil-6524b0a4.js";import"./fbAuth-9e87268e.js";import"./fbApp-26a327c1.js";import"./animations-1dde62f3.js";function z({title:i,setTitle:o,content:r,setContent:u,imagePreview:d,setImagePreview:p,selectedFile:n,setSelectedFile:R}){const v=m=>{o(m.target.value)},x=m=>{u(m.target.value)},y=m=>{const c=m.target.files[0];if(c&&c.type.startsWith("image/")){const l=new FileReader;l.onload=()=>{p(l.result)},l.readAsDataURL(c)}else p(null);R(c);const g=document.getElementById("fileName");g&&(g.value=c?c.name:"첨부파일")};return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sr-only",children:"커뮤니티 폼 입력 섹션"}),e.jsx("div",{className:s.titleWrapper,children:e.jsx("input",{type:"text",placeholder:"제목을 입력하세요.",className:s.title,value:i,onChange:v})}),e.jsxs("div",{className:s.contentWrapper,children:[e.jsxs("div",{className:s.imageContainer,children:[d?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:d,alt:"이미지 미리보기",className:s.imagePreview}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"이미지 변경"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:n?n.name:"첨부파일",id:"fileName",placeholder:"첨부파일",onChange:()=>{},className:s.imageInput}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"파일 찾기"})]}),e.jsx("input",{type:"file",id:"file",onChange:y,className:"h-0 w-0"})]}),e.jsx("textarea",{placeholder:"내용을 입력해주세요.",rows:10,className:s.contentText,value:r,onChange:x})]})]})}z.propTypes={title:t.string.isRequired,setTitle:t.func.isRequired,content:t.string.isRequired,setContent:t.func.isRequired,imagePreview:t.string.isRequired,setImagePreview:t.func.isRequired,selectedFile:t.shape({name:t.string,type:t.string}).isRequired,setSelectedFile:t.func.isRequired};function Q({isEditing:i,handleSave:o}){const r=W(),u=()=>{w.done("변경을 취소했습니다."),r(-1)};return e.jsxs("section",{className:s.buttonWrapper,children:[e.jsx("p",{className:"sr-only",children:"커뮤니티 폼 버튼 섹션"}),e.jsx("button",{type:"button",className:`${s.button} bg-blue-400`,onClick:o,children:e.jsx("span",{className:"block font-medium",children:i?"수정하기":"등록하기"})}),e.jsx("button",{type:"button",className:`${s.button} bg-red-400`,onClick:u,children:e.jsx("span",{className:"block font-medium",children:"취소하기"})})]})}Q.propTypes={isEditing:P.PropTypes.bool.isRequired,handleSave:P.PropTypes.func.isRequired};function G({isEditing:i=!1,data:o=null}){const[r,u]=h.useState(""),[d,p]=h.useState(""),[n,R]=h.useState(null),[v,x]=h.useState(null),y=W(),m=O(),{currentNotice:c,notices:g}=m.state||{},{id:l}=V();h.useEffect(()=>{i&&o&&(u(o.title),p(o.content),x(o.imageUrl))},[i,c]);const H=async()=>{try{const S=await J(k(b,"community")),U=S.size>0?S.size-1:0;if(i){const a=A(b,"community",l);if(await T(a,{title:r,content:d,updatedAt:q()}),n){const C=B(L,`images/community/${l}`);await E(C,n);const D=await I(C);await T(a,{imageUrl:D})}w.success("글이 수정되었습니다.");const f=(await $(a)).data();y(`/community/${l}`,{state:{notices:g,currentNotice:{id:l,data:f}}})}else{const a=await K(k(b,"community"),{index:U,title:r,content:d,imageUrl:null,updatedAt:q()});let j;if(n){const N=B(L,`images/community/${a.id}`);await E(N,n),j=await I(N);const F=A(b,"community",a.id);await T(F,{imageUrl:j})}const f=[...g,{id:a.id,data:{index:U,title:r,content:d,imageUrl:n?j:null,updatedAt:q()}}];w.success("글이 등록되었습니다.");const D=(await $(a)).data();y(`/community/${a.id}`,{state:{notices:f==null?void 0:f.slice().toSorted((N,F)=>F.data.index-N.data.index),currentNotice:{id:a.id,data:D}}})}}catch{w.error("변경 실패하였습니다. 다시 한번 확인해주세요.")}};return e.jsxs("div",{className:s.communityForm,children:[e.jsx(M,{category:"Support",title:"커뮤니티"}),e.jsxs("div",{className:"flex flex-col px-open-gutter-mobile desktop:px-open-gutter-desktop ",children:[e.jsx(z,{title:r,setTitle:u,content:d,setContent:p,selectedFile:n,setSelectedFile:R,imagePreview:v,setImagePreview:x}),e.jsx(Q,{isEditing:i,handleSave:H})]})]})}G.propTypes={isEditing:t.bool,data:t.shape({index:t.number,title:t.string,content:t.string,imageUrl:t.string,updatedAt:t.shape({seconds:t.number,nanoseconds:t.number})})};G.defaultProps={isEditing:!1,data:{index:0,title:"",content:"",imageUrl:"",updatedAt:{seconds:0,nanoseconds:0}}};export{G as default};
