import{j as e,d as N,s as k}from"./index-XLfrnhxv.js";import{c as P,a as J,d as L,s as q,u as F,b as A,f as K}from"./fbStore-ITQ65Lcc.js";import{r as h}from"./react-t7nT_heO.js";import{Q as w}from"./react-toastify.esm-7xZ-A944.js";import{r as $,u as B,a as E}from"./fbStorage-DidXJKWr.js";import{P as t,p as I}from"./index-Nafxz_UV.js";import{B as M}from"./BannerSection-TYV_TVPj.js";import{s}from"./Community.module-RTKzumna.js";import{d as W,u as O,e as V}from"./reactRouter-Jh5tb--W.js";import"./recoil-Y9BdFwrk.js";import"./fbAuth-Cks-JP-t.js";import"./fbApp-WBmmrZ2E.js";function z({title:o,setTitle:i,content:r,setContent:u,imagePreview:d,setImagePreview:p,selectedFile:n,setSelectedFile:R}){const v=m=>{i(m.target.value)},x=m=>{u(m.target.value)},y=m=>{const l=m.target.files[0];if(l&&l.type.startsWith("image/")){const c=new FileReader;c.onload=()=>{p(c.result)},c.readAsDataURL(l)}else p(null);R(l);const g=document.getElementById("fileName");g&&(g.value=l?l.name:"첨부파일")};return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"sr-only",children:"커뮤니티 폼 입력 섹션"}),e.jsx("div",{className:s.titleWrapper,children:e.jsx("input",{type:"text",placeholder:"제목을 입력하세요.",className:s.title,value:o,onChange:v})}),e.jsxs("div",{className:s.contentWrapper,children:[e.jsxs("div",{className:s.imageContainer,children:[d?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:d,alt:"이미지 미리보기",className:s.imagePreview}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"이미지 변경"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:n?n.name:"첨부파일",id:"fileName",placeholder:"첨부파일",onChange:()=>{},className:s.imageInput}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"파일 찾기"})]}),e.jsx("input",{type:"file",id:"file",onChange:y,className:"w-0 h-0"})]}),e.jsx("textarea",{placeholder:"내용을 입력해주세요.",rows:10,className:s.contentText,value:r,onChange:x})]})]})}z.propTypes={title:t.string.isRequired,setTitle:t.func.isRequired,content:t.string.isRequired,setContent:t.func.isRequired,imagePreview:t.string.isRequired,setImagePreview:t.func.isRequired,selectedFile:t.shape({name:t.string,type:t.string}).isRequired,setSelectedFile:t.func.isRequired};function Q({isEditing:o,handleSave:i}){const r=W(),u=()=>{w.done("변경을 취소했습니다."),r(-1)};return e.jsxs("section",{className:s.buttonWrapper,children:[e.jsx("h3",{className:"sr-only",children:"커뮤니티 폼 버튼 섹션"}),e.jsxs("button",{type:"button",className:`${s.button} bg-blue-400`,onClick:i,children:[" ",e.jsxs("span",{className:"block font-medium",children:[o?"수정하기":"등록하기"," "]})]}),e.jsxs("button",{type:"button",className:`${s.button} bg-red-400`,onClick:u,children:[" ",e.jsx("span",{className:"block font-medium",children:"취소하기"})]})]})}Q.propTypes={isEditing:I.PropTypes.bool.isRequired,handleSave:I.PropTypes.func.isRequired};function G({isEditing:o=!1,data:i=null}){const[r,u]=h.useState(""),[d,p]=h.useState(""),[n,R]=h.useState(null),[v,x]=h.useState(null),y=W(),m=O(),{currentNotice:l,notices:g}=m.state||{},{id:c}=V();h.useEffect(()=>{o&&i&&(u(i.title),p(i.content),x(i.imageUrl))},[o,l]);const H=async()=>{try{const S=await J(P(N,"community")),U=S.size>0?S.size-1:0;if(o){const a=L(N,"community",c);if(await F(a,{title:r,content:d,updatedAt:q()}),n){const C=$(k,`images/community/${c}`);await B(C,n);const D=await E(C);await F(a,{imageUrl:D})}w.success("글이 수정되었습니다.");const f=(await A(a)).data();y(`/community/${c}`,{state:{notices:g,currentNotice:{id:c,data:f}}})}else{const a=await K(P(N,"community"),{index:U,title:r,content:d,imageUrl:null,updatedAt:q()});let b;if(n){const j=$(k,`images/community/${a.id}`);await B(j,n),b=await E(j);const T=L(N,"community",a.id);await F(T,{imageUrl:b})}const f=[...g,{id:a.id,data:{index:U,title:r,content:d,imageUrl:n?b:null,updatedAt:q()}}];w.success("글이 등록되었습니다.");const D=(await A(a)).data();y(`/community/${a.id}`,{state:{notices:f==null?void 0:f.slice().toSorted((j,T)=>T.data.index-j.data.index),currentNotice:{id:a.id,data:D}}})}}catch{w.error("변경 실패하였습니다. 다시 한번 확인해주세요.")}};return e.jsxs("div",{className:"mb-open-5xl w-full h-full desktop:px-open-margin-desktop tablet:px-open-margin-desktop px-open-gutter-mobile",children:[e.jsx(M,{category:"Support",title:"커뮤니티"}),e.jsxs("div",{className:"flex flex-col px-open-gutter-mobile desktop:px-open-gutter-desktop ",children:[e.jsx(z,{title:r,setTitle:u,content:d,setContent:p,selectedFile:n,setSelectedFile:R,imagePreview:v,setImagePreview:x}),e.jsx(Q,{isEditing:o,handleSave:H})]})]})}G.propTypes={isEditing:t.bool,data:t.shape({index:t.number,title:t.string,content:t.string,imageUrl:t.string,updatedAt:t.shape({seconds:t.number,nanoseconds:t.number})})};G.defaultProps={isEditing:!1,data:{index:0,title:"",content:"",imageUrl:"",updatedAt:{seconds:0,nanoseconds:0}}};export{G as default};
